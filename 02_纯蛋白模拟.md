## 1. 蛋白预处理
蛋白的预处理比较简单，只需要将从RCSB PDB数据库中获取的蛋白部分进行质子化即可，在剔除非蛋白部分的原子后，可以使用AmberTools中的pdb4amber完成蛋白质的加氢。
```bash
# 需要在AmberTools的conda环境中执行
# conda activate AmberTools
pdb4amber -i test.pdb -o rec.pdb -y --reduce
```

> -i：输入蛋白质的pdb格式文件；
> 
> -y：该参数是指去除所有氢原；
> 
> --reduce ： 运行Reduce来加氢；
> 
之所以用了-y和–reduce选项，是因为pdb4amber会检查每个组氨酸（HIE、HIP、HID）的类型，如果用其他软件加氢则不一定是amber所支持的原子类型，所以还是用pdb4amber一劳永逸吧。

## 2. 生成Amber输入文件
### 2.1 准备tleap.leaprc 文件
内容如下所示：
>source leaprc.protein.ff14SB                              #蛋白ff14SB力场
>
>source leaprc.water.tip3p                                  #水的tip3p力场
>
>set default pbradii bondi                                  #原子半径
>
>loadamberparams frcmod.ionsjc_tip3p                        #溶剂的力场参数文件
>
>rec = loadpdb rec.pdb                                      #加载蛋白文件(上一步生成的rec.pdb，需要根据情况更新)
>
>addions rec Na+ 0                                          #电荷平衡
>
>addions rec Cl- 0                                          #电荷平衡
>
>solvateoct rec TIP3PBOX 10                                 #形成一个TIP3P水模型的盒子，半径是10埃米
>
>saveamberparm rec rec_ions.prmtop rec_ions.inpcrd        #保存amber格式的拓扑和坐标文件
>
>quit
​

### 2.2 运行tleap
```bash
# 同样需要在AmberTools的conda环境中执行
tleap -f tleap.leaprc
```
- 最终生成输出：**rec_ions.prmtop** 和 **rec_ions.inpcrd**

## 3. 运行模拟
### 3.1 运行一个100ns的模拟
模拟脚本amber_run.sh如下所示：
```bash
# amber20
source /home/xxx/yyy/software/amber20/amber.sh
export AMBERSOURCE=/home/xxx/software/amber20_src

#expose a single GPU to the pmemd.cuda executable
export CUDA_VISIBLE_DEVICES="1"

#Minimize the system with restraints just on the backbone of the molecule
pmemd.cuda -O -i min1.in -o rec_ions_min1.out -p rec_ions.prmtop -c rec_ions.inpcrd -r rec_ions_min1.rst -ref rec_ions.inpcrd

#Relax the system with no restraints
pmemd.cuda -O -i min2.in -o rec_ions_min2.out -p rec_ions.prmtop -c rec_ions_min1.rst -r rec_ions_min2.rst

#Heat up the system from 100 K under constant volume
pmemd.cuda -O -i heat.in -o rec_ions_heat.out -p rec_ions.prmtop -c rec_ions_min2.rst -r rec_ions_heat.rst  -x rec_ions_heat.nc -ref rec_ions_min2.rst

#Relax the system at a constant pressure
pmemd.cuda -O -i press.in -o rec_ions_press.out -p rec_ions.prmtop -c rec_ions_heat.rst -r rec_ions_press.rst -x rec_ions_press.nc -ref rec_ions_min2.rst

#eq, 10ns
pmemd.cuda -O -i eq.in -o rec_ions_eq.out -p rec_ions.prmtop -c rec_ions_press.rst -r rec_ions_eq.rst -x rec_ions_eq.nc

#md, 100ns
pmemd.cuda -O -i md.in -o rec_ions_md.out -p rec_ions.prmtop -c rec_ions_eq.rst -r rec_ions_md.rst -x rec_ions_md.nc
```

### 3.2 提交运行脚本
```bash
nohup bash amber_run.sh >md.log 2>&1 &
```

## 4. 模拟参数








